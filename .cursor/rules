# Your Are Loud - Cursor Rules

## About This File

**IMPORTANT:** This project uses `.cursor/rules` (this file) for Cursor IDE rules.

- âœ… **Correct:** `.cursor/rules` (this file)
- âŒ **Wrong:** `.cursorrules` (do NOT create this)

If you need to update project rules, always update this file: `.cursor/rules`

---

## Project Overview

Cross-platform voice monitoring application that alerts users when speaking too loudly.
- **Type:** Monorepo with multiple platform apps and shared packages
- **Platforms:** macOS (Swift), Windows (C#/.NET), Mobile (React Native), Chrome Extension (TypeScript)
- **Package Manager:** pnpm (workspaces)

## Documentation Structure

### PRIMARY RULE: Documentation is centralized in `docs/` folder

All comprehensive documentation lives in `docs/`. App READMEs contain only quick start info and links to tech specs.

**Documentation Hierarchy:**
```
docs/
â”œâ”€â”€ README.md                      # START HERE - Documentation index
â”œâ”€â”€ DOCUMENTATION_STRUCTURE.md     # How docs are organized
â”œâ”€â”€ DEDUPLICATION_SUMMARY.md       # Duplicate elimination work
â”œâ”€â”€ quick-start.md                 # 5-minute setup guide
â”œâ”€â”€ architecture.md                # System architecture
â”œâ”€â”€ monorepo-structure.md          # Folder organization
â”œâ”€â”€ contributing.md                # Contribution guidelines
â”œâ”€â”€ implementation-summary.md      # Current implementation status
â”œâ”€â”€ refactoring-summary.md         # Mobile app consolidation
â””â”€â”€ tech-spec/                     # Complete platform documentation
    â”œâ”€â”€ mobile.md                  # iOS & Android (React Native) âœ… COMPLETE
    â”œâ”€â”€ chrome-extension.md        # Chrome extension âœ… COMPLETE
    â”œâ”€â”€ macos.md                   # macOS native app ğŸš§ PARTIAL
    â””â”€â”€ windows.md                 # Windows native app ğŸš§ PARTIAL
```

**Quick Reference: Documentation Locations**

| Component | Tech Spec | App README | Status |
|-----------|-----------|------------|--------|
| **Mobile (iOS & Android)** | `docs/tech-spec/mobile.md` | `apps/mobile/README.md` | âœ… Complete |
| **Chrome Extension** | `docs/tech-spec/chrome-extension.md` | `apps/chrome-extension/README.md` | âœ… Complete |
| **macOS App** | `docs/tech-spec/macos.md` | `apps/macos/README.md` | ğŸš§ Partial |
| **Windows App** | `docs/tech-spec/windows.md` | `apps/windows/README.md` | ğŸš§ Partial |
| **Core Package** | N/A | `packages/core/README.md` | âœ… Complete |
| **Audio Processing** | N/A | `packages/audio-processing/README.md` | âœ… Complete |
| **Notifications** | N/A | `packages/notifications/README.md` | âœ… Complete |

**Finding Documentation:**
- **Overview & Setup:** Start with `docs/README.md`
- **Quick Start:** `docs/quick-start.md`
- **Platform Development:** `docs/tech-spec/[platform].md`
- **Architecture:** `docs/architecture.md`
- **Contributing:** `docs/contributing.md`

## Repository Structure

```
your-are-loud/
â”œâ”€â”€ apps/                    # Platform-specific applications
â”‚   â”œâ”€â”€ mobile/              # iOS & Android (unified React Native)
â”‚   â”‚   â”œâ”€â”€ src/             # Shared React Native code
â”‚   â”‚   â”œâ”€â”€ android/         # Android native code ONLY
â”‚   â”‚   â””â”€â”€ ios/             # iOS native code ONLY
â”‚   â”œâ”€â”€ macos/               # macOS native (Swift)
â”‚   â”œâ”€â”€ windows/             # Windows native (C#/.NET MAUI)
â”‚   â””â”€â”€ chrome-extension/    # Chrome extension (TypeScript)
â”‚
â”œâ”€â”€ packages/                # Shared TypeScript packages
â”‚   â”œâ”€â”€ core/                # Core logic, types, constants
â”‚   â”œâ”€â”€ audio-processing/    # Audio algorithms (RMS, normalization)
â”‚   â””â”€â”€ notifications/       # Notification management
â”‚
â”œâ”€â”€ docs/                    # ALL DOCUMENTATION (see above)
â”œâ”€â”€ scripts/                 # Build & utility scripts
â””â”€â”€ [config files]           # package.json, pnpm-workspace.yaml, etc.
```

## Key Architectural Decisions

### 1. Mobile: Single React Native App
- **Location:** `apps/mobile/`
- **Rationale:** iOS and Android share 95% of code
- **Structure:** Shared code in `src/`, native code in `android/` and `ios/`
- **DO NOT:** Create separate `apps/android/` or `apps/ios/` folders
- **History:** Consolidated from separate apps (see `docs/refactoring-summary.md`)

### 2. Shared Packages
- **Purpose:** Share business logic across platforms
- **Usage:** TypeScript/JavaScript platforms use directly, native platforms reimplement algorithms
- **Packages:**
  - `@your-are-loud/core` - Threshold detection, types, constants
  - `@your-are-loud/audio-processing` - RMS calculation, normalization
  - `@your-are-loud/notifications` - Notification cooldown, management

### 3. Documentation Organization
- **Centralized:** All docs in `docs/` folder
- **Single Source:** Each piece of info exists in ONE place
- **Tech Specs:** Complete documentation for each platform
- **No Duplication:** App READMEs are brief (< 100 lines), link to tech specs
- **History:** Deduplicated and reorganized (see `docs/DEDUPLICATION_SUMMARY.md`)

## Development Guidelines

### When Adding Features

1. **Determine Location:**
   - Platform-specific code â†’ `apps/[platform]/`
   - Shared logic â†’ `packages/` (if reusable)
   - Platform UI â†’ Platform's source folder

2. **Update Documentation:**
   - Detailed docs â†’ `docs/tech-spec/[platform].md`
   - Quick commands â†’ `apps/[platform]/README.md` (if needed)
   - Architecture changes â†’ `docs/architecture.md`
   - **DO NOT duplicate content between files**

3. **Follow Platform Patterns:**
   - **Mobile:** React Native components in `apps/mobile/src/`
   - **Chrome:** Background/Content/Popup architecture
   - **macOS:** SwiftUI with MVVM
   - **Windows:** .NET MAUI with MVVM

### When Updating Documentation

**CRITICAL RULES:**
1. **Single Source of Truth** - Update content in ONE place only
2. **App README** - Only quick start (< 100 lines), link to tech spec
3. **Tech Spec** - Complete documentation (architecture, API, deployment)
4. **No Duplication** - Use links to reference other docs
5. **Update Index** - Add new docs to `docs/README.md`

**Example (Correct):**
```
1. Add detailed feature docs to docs/tech-spec/mobile.md
2. Add brief mention to apps/mobile/README.md with link
3. Update docs/README.md if needed
```

**Example (Incorrect):**
```
âŒ Add same content to both app README and tech spec
âŒ Copy documentation between files
âŒ Create docs outside docs/ folder
```

### Documentation Update Workflow

**Before Starting Work:**
1. Check tech spec status (see table above)
2. If incomplete (ğŸš§): Fill in sections as you implement
3. If complete (âœ…): Keep updated with your changes

**During Development:**
1. Make code changes
2. Document as you go - don't wait
3. Update architecture diagrams if structure changes
4. Add troubleshooting tips for issues encountered

**Before Committing:**
1. Verify tech spec is updated
2. Update "Last Updated" date (if present)
3. Add entry to "Change Log" section (if present)
4. Ensure docs and code are in sync

**Example Commit:**
```bash
git commit -m "feat(mobile): add settings screen

- Implement settings UI with React Native
- Add AsyncStorage persistence
- Add threshold adjustment controls

Docs updated:
- docs/tech-spec/mobile.md: Added settings screen section
- apps/mobile/README.md: Updated feature list"
```

### Code Style & Standards

**TypeScript/JavaScript:**
- ESLint + Prettier (configured in root)
- Use shared packages via workspace imports: `@your-are-loud/*`
- Follow React/React Native best practices
- Use explicit types, avoid `any`

**Mobile (React Native):**
- Shared code in `apps/mobile/src/`
- Use React hooks and functional components
- Context API for state management
- Native modules in platform folders (`android/`, `ios/`)

**Chrome Extension:**
- Manifest V3 architecture
- Background service worker
- Offscreen document for audio processing
- TypeScript with strict mode
- Message handlers must return `true` for async operations

**Swift (macOS):**
- SwiftUI for UI
- AVFoundation for audio
- Follow Swift style guide
- MVVM pattern

**C# (Windows):**
- .NET MAUI framework
- MVVM pattern
- Follow C# conventions

## Common Tasks

### Setting Up Development

```bash
# Install dependencies
pnpm install

# Build shared packages
pnpm run build

# Run specific platform
cd apps/mobile && npm install && npm run android
cd apps/chrome-extension && npm run build
```

### Building

```bash
# Build shared packages only
pnpm run build

# Build everything
./scripts/build-all.sh

# Clean everything
./scripts/clean.sh
```

### Finding Information

**"How do I set up [platform]?"**
â†’ `docs/tech-spec/[platform].md`

**"How does the audio processing work?"**
â†’ `docs/architecture.md` + `packages/audio-processing/README.md`

**"How do I contribute?"**
â†’ `docs/contributing.md`

**"What's the folder structure?"**
â†’ `docs/monorepo-structure.md`

**"How to use shared packages?"**
â†’ `packages/[package]/README.md`

**"Why is mobile unified?"**
â†’ `docs/refactoring-summary.md`

**"How are docs organized?"**
â†’ `docs/DOCUMENTATION_STRUCTURE.md`

## File Naming Conventions

**Documentation:**
- Use lowercase with hyphens: `quick-start.md`
- Place in `docs/` folder
- Tech specs in `docs/tech-spec/`

**Code:**
- **TypeScript/JavaScript:** camelCase for files, PascalCase for components
- **React Native:** PascalCase for components (e.g., `MainScreen.tsx`)
- **Swift:** PascalCase for files
- **C#:** PascalCase for files

## Testing

**Shared Packages:**
```bash
cd packages/core && pnpm test
```

**Mobile:**
```bash
cd apps/mobile && npm test
```

**Chrome Extension:**
```bash
cd apps/chrome-extension && npm test
```

## Important Notes

### âœ… DO:
- Keep documentation in `docs/` folder
- Use shared packages for common logic
- Follow single source of truth principle
- Update documentation with code changes
- Write brief app READMEs with links to tech specs
- Use workspace imports for shared packages
- Check existing docs before creating new ones

### âŒ DON'T:
- Create separate Android/iOS apps (use unified `apps/mobile/`)
- Duplicate documentation content
- Put comprehensive docs in app READMEs
- Create docs outside `docs/` folder
- Skip updating documentation
- Copy code between platforms (use shared packages)
- **Create `.cursorrules` file** (ALWAYS use `.cursor/rules` instead)

## Architecture Rules

### Chrome Extension Component Responsibilities

**Never violate these separations:**

1. **Popup** - UI only, no business logic
   - âŒ Do not access microphone directly
   - âŒ Do not perform audio processing
   - âœ… Only send messages to background
   - âœ… Display data received from background

2. **Background Service Worker** - Orchestration only
   - âŒ Do not access microphone
   - âŒ Do not access DOM
   - âœ… Route messages between components
   - âœ… Manage offscreen document lifecycle

3. **Offscreen Document** - Audio processing only
   - âœ… Access microphone via getUserMedia
   - âœ… Perform audio calculations
   - âœ… Send results to background
   - âŒ Do not manipulate tab DOM

4. **Content Script** - Visual feedback only
   - âœ… Create/manage overlay element
   - âœ… Respond to show/hide messages
   - âŒ Do not access microphone

### Message Flow Pattern

**Always follow:**
```
User Action (Popup)
  â†’ Message to Background
  â†’ Background orchestrates
  â†’ Messages to Offscreen/Content
  â†’ Response back through Background
  â†’ Update Popup UI
```

**Never allow direct communication between:**
- Popup â†” Offscreen
- Popup â†” Content Script
- Offscreen â†” Content Script

**Always go through Background Service Worker as the message router.**

## Common Pitfalls to Avoid

### 1. Async Message Handlers
```typescript
// âŒ WRONG - Missing return true
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  handleAsync().then(sendResponse);
  // Missing return true - response won't be sent!
});

// âœ… CORRECT
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  handleAsync().then(sendResponse);
  return true; // Keeps message channel open
});
```

### 2. Resource Cleanup
```typescript
// âŒ WRONG - Memory leak
stopMonitoring() {
  this.isMonitoring = false;
  // Forgot to close AudioContext!
}

// âœ… CORRECT
stopMonitoring() {
  this.isMonitoring = false;
  if (this.audioContext) {
    this.audioContext.close();
    this.audioContext = null;
  }
  if (this.stream) {
    this.stream.getTracks().forEach(track => track.stop());
  }
}
```

### 3. Documentation Duplication
```
// âŒ WRONG - Duplicating content
Update apps/mobile/README.md with full architecture
Also update docs/tech-spec/mobile.md with same content

// âœ… CORRECT - Single source of truth
Update docs/tech-spec/mobile.md with full architecture
Update apps/mobile/README.md with brief mention + link
```

## Quick Reference

| Task | Command/Location |
|------|-----------------|
| **Documentation Index** | `docs/README.md` |
| **Quick Setup** | `docs/quick-start.md` |
| **Mobile Dev** | `docs/tech-spec/mobile.md` |
| **Chrome Dev** | `docs/tech-spec/chrome-extension.md` |
| **Architecture** | `docs/architecture.md` |
| **Contributing** | `docs/contributing.md` |
| **Build All** | `./scripts/build-all.sh` |
| **Clean All** | `./scripts/clean.sh` |
| **Setup** | `./scripts/setup.sh` |

## Priority Order When Searching

1. **Documentation Index** - `docs/README.md` (navigation hub)
2. **Tech Specs** - `docs/tech-spec/[platform].md` (complete docs)
3. **Architecture** - `docs/architecture.md` (system design)
4. **Package READMEs** - `packages/[package]/README.md` (API reference)
5. **App READMEs** - `apps/[platform]/README.md` (quick start only)

## Workspace Configuration

- **Package Manager:** pnpm with workspaces
- **Workspace File:** `pnpm-workspace.yaml`
- **Shared Packages:** Auto-linked via `workspace:*` protocol
- **Build Order:** Packages first, then apps

## When in Doubt

1. **Check the documentation index** - `docs/README.md`
2. **Check the tech spec** - `docs/tech-spec/[platform].md`
3. **Follow existing patterns** - Look at similar code
4. **Test thoroughly** - Better safe than sorry
5. **Document changes** - Update tech spec immediately
6. **Ask for review** - Complex changes need review

## Meta: About These Rules

**This file location:** `.cursor/rules`

- This is the ONLY place for Cursor IDE project rules
- Do NOT create `.cursorrules` in the root
- If you need to add rules, update THIS file
- This file should be version controlled (git tracked)

**Why `.cursor/rules` and not `.cursorrules`?**
- `.cursor/rules` is the standard location for Cursor IDE
- It was already present in this project
- It's properly recognized by Cursor
- Keeps project root clean

## Remember

> "Good documentation is as important as good code. Update both together."

**Every architectural change = Documentation update**

**Key Principles:**
- Documentation centralized in `docs/`
- Single source of truth (no duplication)
- App READMEs are brief (< 100 lines)
- Tech specs are comprehensive
- Mobile is unified (not separate android/ios)

This ensures the project remains maintainable and new developers can onboard quickly.

---

**Last Updated:** January 2026
